\RequirePackage{mathtools}
\RequirePackage{amssymb}
\RequirePackage{bm}
\RequirePackage{suffix}
\RequirePackage{etoolbox}

%%%%%%%%%%%
%% To do %%
%%%%%%%%%%%

% Better document structure!

% Mixed partial derivatives. (Long term project!)

% Function definitions.

% Vector space specific inner products. (See mathtools documentation.)

% Consider generalising \Ltwo to general L^p spaces.

% Identity and zero matrices. And consider the future of \identity!

% Consider redefining intervals as paired delimiters.

% More convenient way to make roman subscripts (and super-?).

% Differentials: Find automatic way to check if the next symbol is a full stop or comma, in which case the spacing should be diminished. Until then, making the punctuation part of the argument solves the problem (but it's a hack).

% Consider separating \inner out into physics and mathematics specific files.


%%%%%%%%%%%
%% Notes %%
%%%%%%%%%%%

% This script redefines the following commands:
	% \deg
	% \d	(redefined as \underdot)
	% \det
	% \dim
	% \div	(redefined as \divsymb)
	% \Im
	% \ker
	% \Re
	% \vec

% In case of alignment issues or other problems with vectors, see https://tex.stackexchange.com/a/10643/63353.

% Note that '\span' is a primitive command used in \multicolumn (see https://tex.stackexchange.com/questions/33264/span-as-a-math-operator), so the span of a set of vectors is defined as '\Span'.

% L^2: Explicit domains should probably be specified manually, since they in general require parentheses (for instance L^2(R)), but not in the case of intervals. But consider using an if-statement to check.


%%%%%%%%%%%%%%%%%%%%%
%% Vector notation %%
%%%%%%%%%%%%%%%%%%%%%

% Typeset bold upright vectors. Use starred version for greek letters and symbols. The argument to bm contains an extra pair of braces to avoid alignment problems.
\renewcommand{\vec}[1]{\mathbf{#1}}
\WithSuffix\newcommand\vec*[1]{\bm{{#1}}}

% Alternative bold italic vectors. Keep the starred version for compatibility with the above version.
%\renewcommand{\vec}[1]{\bm{{#1}}}
%\WithSuffix\newcommand\vec*[1]{\bm{{#1}}}

% Hat vectors
\newcommand{\hatvec}[1]{\hat{\vec{#1}}}
\WithSuffix\newcommand\hatvec*[1]{\hat{\vec*{{#1}}}}

% Unit vectors
\newcommand{\ihat}{\bm{\hat{\textbf{\i}}}}
\newcommand{\jhat}{\bm{\hat{\textbf{\j}}}}
\newcommand{\khat}{\hatvec{k}}
\newcommand{\xhat}{\hatvec{x}}
\newcommand{\yhat}{\hatvec{y}}
\newcommand{\zhat}{\hatvec{z}}


%%%%%%%%%%%%%%%%%%%%
%% Linear algebra %%
%%%%%%%%%%%%%%%%%%%%

% Maps, operators and matrices
\newcommand{\op}[1]{\hat{#1}}					% Operator
\newcommand{\identity}{\op{1}}					% Identity operator
\renewcommand{\det}{\operatorname{det}}			% Determinant
\DeclareMathOperator{\tr}{Tr}					% Trace
\newcommand{\trans}[1]{#1^{T}}					% Matrix transpose

% Vector spaces
\renewcommand{\dim}{\operatorname{dim}}			% Dimension
\DeclareMathOperator{\Span}{span}				% Span (see note)
\newcommand{\orthog}[1]{#1^{\perp}}				% Orthogonal complement

% Maps on vector spaces
\DeclarePairedDelimiterX{\inner}[2]%
	{\langle}{\rangle}{
		\ifblank{#1}{\:\cdot\:}{#1},
		\ifblank{#2}{\:\cdot\:}{#2}
	}											% Inner product
\DeclarePairedDelimiterX{\norm}[1]%
	{\lVert}{\rVert}{
		\ifblank{#1}{\:\cdot\:}{#1}
	}											% Norm


%%%%%%%%%%%%%%
%% Calculus %%
%%%%%%%%%%%%%%

% Derivatives: Optional argument is order. Leave the first mandatory argument blank for derivative operator.
\let\d\underdot
\newcommand{\d}[2][\hspace{-0.5pt}]%
	{\mathop{\mathrm{d}^{#1}#2}}				% Differential
\newcommand{\pd}[2][\hspace{-0.5pt}]%
	{\mathop{\partial^{#1}#2}}					% Partial differential
\newcommand{\dv}[3][\hspace{-0.5pt}]%
	{\frac{\d[#1]{#2}}{\d{#3}^{#1}}}			% Ordinary derivative
\newcommand{\pdv}[3][\hspace{-0.5pt}]%
	{\frac{\pd[#1]{#2}}{\pd{#3}^{#1}}}			% Partial derivative

% Old derivative commands
%\newcommand{\dif}{\mathrm{d}}					% Differential
%\newcommand{\dv}[3][\hspace{-0.5pt}]%
%	{\frac{\dif^{#1} #2}{\dif #3^{#1}}}			% Ordinary derivative


% Vector operators: To differentiate with respect to a particular vector, use the optional argument.
\let\div\divsymb
\newcommand{\grad}[2][\hspace{0.5pt}]%
	{\nabla_{\!#1} #2}							% Gradient
\newcommand{\div}[2][\hspace{0.5pt}]%
	{\nabla_{\!#1} \cdot #2}					% Divergence
\newcommand{\curl}[2][\hspace{0.5pt}]%
	{\nabla_{\!#1} \times #2}					% Curl


%%%%%%%%%%
%% Sets %%
%%%%%%%%%%

% Set builder notation
\DeclarePairedDelimiterX{\set}[2]{\{}{\}}{#1\,\delimsize\vert\,\mathopen{}#2}

% Miscellaneous sets
\newcommand{\continuous}[3][\hspace{-0.5pt}]%
	{C^{#1} (#2,#3)}							% Continuously differentiable functions
\newcommand{\smooth}[2]{C^\infty (#1,#2)}		% Smooth functions
\newcommand{\linear}[2]{\mathcal{L}(#1,#2)}		% Linear maps
\newcommand{\Hilbert}{\mathcal{H}}				% Hilbert space
\newcommand{\Ltwo}{L^2}							% L^2 (see notes)
\newcommand{\Mat}[2]{\mathrm{Mat}_{#1}(#2)}		% Set Mat_n(F) of matrices

% Blackboard bold sets
\newcommand{\N}{\mathbb{N}}						% Natural numbers
\newcommand{\Z}{\mathbb{Z}}						% Integers
\newcommand{\Q}{\mathbb{Q}}						% Rational numbers
\newcommand{\R}{\mathbb{R}}						% Real numbers
\newcommand{\C}{\mathbb{C}}						% Complex numbers
\newcommand{\K}{\mathbb{K}}						% K field
\newcommand{\F}{\mathbb{F}}						% F field

% Intervals
\DeclarePairedDelimiter{\intoo}{]}{[}			% Open
\DeclarePairedDelimiter{\intcc}{[}{]}			% Closed
\DeclarePairedDelimiter{\intoc}{]}{]}			% Open left, closed right
\DeclarePairedDelimiter{\intco}{[}{[}			% Closed right, open left


%%%%%%%%%%%%%%%%%%%
%% Miscellaneous %%
%%%%%%%%%%%%%%%%%%%

% Complex numbers
\renewcommand{\Re}{\operatorname{Re}}			% Real part
\renewcommand{\Im}{\operatorname{Im}}			% Imaginary part

% Maps
\renewcommand{\ker}{\operatorname{ker}}			% Kernel
\DeclareMathOperator{\im}{Im}					% Image
\newcommand{\id}[1][\hspace{-0.5pt}]%
	{\mathrm{Id}_{#1}}							% Identity map

% Miscellaneous operations
\newcommand{\mean}[1]{\overline{#1}}			% Mean
\DeclarePairedDelimiterX{\abs}[1]%
	{\lvert}{\rvert}{
		\ifblank{#1}{\:\cdot\:}{#1}
	}											% Absolute value
\DeclareMathOperator{\sgn}{sgn}					% Sign
\renewcommand{\deg}{\operatorname{deg}}			% Degree (e.g. of polynomium)

% Statistics
\newcommand{\std}[1][\hspace{0.7pt}]%
	{\sigma_{#1}}								% Standard deviation
\newcommand{\var}{\operatorname{Var}}			% Variance


